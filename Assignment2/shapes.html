<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>WebGL Example</title>

    <!-- External scripts -->
    <script src="Common/initShaders.js"></script>
    <script src="Common/MV.js"></script>
    <script src="Common/MatrixStack.js"></script>
    <script src="shapes.js"></script>
</head>
<body>
    <!-- Canvas element for WebGL -->
    <canvas id="webgl-canvas" width="800" height="800"></canvas>

    <!-- Vertex Shader -->
    <script id="vertex-shader" type="x-shader/x-vertex">
        #version 300 es
        in vec4 aPosition;
        uniform float uAngle;
        void main() {
            float rad = radians(uAngle);
            mat4 rotationMatrix = mat4(
                cos(rad), sin(rad), 0.0, 0.0,
               -sin(rad), cos(rad), 0.0, 0.0,
                0.0,      0.0,      1.0, 0.0,
                0.0,      0.0,      0.0, 1.0
            );
            gl_Position = rotationMatrix * aPosition;
        }
    </script>

    <!-- Fragment Shader -->
    <script id="fragment-shader" type="x-shader/x-fragment">
        #version 300 es
        precision mediump float;
        out vec4 fragColor;
        void main() {
            fragColor = vec4(1.0, 0.0, 0.0, 1.0); // Red color
        }
    </script>

    <!-- JavaScript to initialize WebGL -->
    <script>
        let gl = undefined;
        let program, uAngle, angle = 0.0;

        function getShaderSource(id) {
            let shaderScript = document.getElementById(id);
            if (!shaderScript) {
                alert("Unable to load shader: " + id);
                return null;
            }
            return shaderScript.text;
        }

        function init() {
            let canvas = document.getElementById("webgl-canvas");
            gl = canvas.getContext("webgl2");
            if (!gl) {
                alert("Your Web browser doesn't support WebGL 2\nPlease contact Dave");
                return;
            }

            // Initialize shaders
            program = initShaders(gl, "vertex-shader", "fragment-shader");
            uAngle = gl.getUniformLocation(program, "uAngle");

            // Vertex buffer data (triangle)
            let vertices = new Float32Array([
                0.0,  0.5,
               -0.5, -0.5,
                0.5, -0.5
            ]);

            let buffer = gl.createBuffer();
            gl.bindBuffer(gl.ARRAY_BUFFER, buffer);
            gl.bufferData(gl.ARRAY_BUFFER, vertices, gl.STATIC_DRAW);

            let aPosition = gl.getAttribLocation(program, "aPosition");
            gl.vertexAttribPointer(aPosition, 2, gl.FLOAT, false, 0, 0);
            gl.enableVertexAttribArray(aPosition);

            // Set background color
            gl.clearColor(0.2, 0.2, 0.2, 1.0);
            render();
        }

        function render() {
            gl.clear(gl.COLOR_BUFFER_BIT);
            gl.useProgram(program);

            angle += 5.0;
            angle %= 360.0;

            gl.uniform1f(uAngle, angle);
            gl.drawArrays(gl.TRIANGLES, 0, 3);

            requestAnimationFrame(render);
        }

        window.onload = init;
    </script>
</body>
</html>
